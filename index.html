 <!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>HP Optimizer — Clean, FPS & Network Check</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#0ea5ff;--muted:#94a3b8;--glass: rgba(255,255,255,0.04)}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#e6eef8;background:linear-gradient(180deg,#071426 0%,#041025 100%);}
    .wrap{max-width:980px;margin:18px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center}
    h1{margin:0;font-size:18px}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:16px}
    @media(min-width:880px){.grid{grid-template-columns:1fr 360px}}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .row{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;color:#04203b;padding:8px 12px;border-radius:10px;font-weight:600}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
    small{color:var(--muted)}

    .stats{display:flex;gap:8px;flex-wrap:wrap}
    .stat{flex:1;min-width:120px;background:var(--glass);padding:10px;border-radius:10px}
    .stat h2{margin:0;font-size:20px}
    .stat p{margin:6px 0 0 0;color:var(--muted);font-size:13px}

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .notice{background:#042035;padding:10px;border-radius:8px;color:var(--muted);font-size:13px}

    .fps-box{display:flex;flex-direction:column;gap:8px}
    .meter{height:10px;background:rgba(255,255,255,0.06);border-radius:8px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#7dd3fc)}

    footer{margin-top:12px;text-align:center;color:var(--muted);font-size:12px}

    /* small touches */
    .mono{font-family:monospace;font-size:13px}
    .kbd{background:#021018;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.02);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>HP Optimizer</h1>
        <p class="lead">Bersihkan, monitor FPS, dan cek koneksi jaringan (Mbps) — semua di satu halaman.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card" id="main">
        <section>
          <h3 style="margin:0 0 8px 0">Optimasi & Pembersihan</h3>
          <div class="row">
            <button id="btn-clean">Bersihkan (cache lokal)</button>
            <button class="btn-ghost" id="btn-suggestions">Tips cepat</button>
          </div>
          <div style="margin-top:10px" id="clean-result" class="notice">Belum ada aksi.</div>
        </section>

        <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <section>
          <h3 style="margin:0 0 8px 0">FPS Monitor & Booster</h3>
          <div class="fps-box">
            <div class="row"><strong>FPS saat ini:</strong> <div style="width:10px"></div> <div id="fpsValue" class="mono">-</div></div>
            <div class="meter"><div class="bar" id="fpsBar"></div></div>
            <div class="controls">
              <button id="btn-toggle-boost">Aktifkan Mode Game</button>
              <button class="btn-ghost" id="btn-stop-anim">Jeda Animasi Halaman</button>
              <button class="btn-ghost" id="btn-run-demo">Jalankan Demo (Canvas)</button>
            </div>
            <div id="fps-note" class="notice">Catatan: Aplikasi web tidak bisa mengubah refresh rate layar perangkat. "Mode Game" di sini memprioritaskan rendering pada halaman ini dan menghentikan animasi lain — hasil tergantung device.</div>
            <canvas id="gameCanvas" width="540" height="240" style="width:100%;border-radius:8px;display:none;margin-top:8px"></canvas>
          </div>
        </section>

        <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">

        <section>
          <h3 style="margin:0 0 8px 0">Tes Koneksi & Kecepatan</h3>
          <div class="row">
            <button id="btn-speed">Jalankan Speed Test</button>
            <button class="btn-ghost" id="btn-ping">Cek Ping</button>
            <button class="btn-ghost" id="btn-conninfo">Info Koneksi</button>
          </div>

          <div style="margin-top:10px" class="stats">
            <div class="stat"><h2 id="downlink">- Mbps</h2><p>Download (estimasi)</p></div>
            <div class="stat"><h2 id="ping">- ms</h2><p>Ping</p></div>
            <div class="stat"><h2 id="type">-</h2><p>Tipe Koneksi</p></div>
            <div class="stat"><h2 id="rtt">- ms</h2><p>RTT (estimated)</p></div>
          </div>
          <div id="speed-log" class="notice" style="margin-top:10px">Hasil speed test akan muncul di sini.</div>
        </section>
      </div>

      <aside class="card">
        <h3 style="margin:0 0 8px 0">Panduan Singkat</h3>
        <ol style="padding-left:16px;margin:0;color:var(--muted);font-size:14px">
          <li>Tutup aplikasi berat (browser tab, game) untuk mengosongkan RAM.</li>
          <li>Gunakan <span class="kbd">Mode Game</span> atau matikan animasi untuk stabilkan FPS.</li>
          <li>Untuk jaringan: gunakan Wi‑Fi 5GHz atau jaringan seluler yang kuat.</li>
          <li>Perbarui OS & driver graphics apabila tersedia.</li>
        </ol>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)">
        <h4 style="margin:0 0 8px 0">Catatan Penting</h4>
        <p style="margin:0;color:var(--muted);font-size:13px">Halaman web ini menyediakan alat diagnostik dan beberapa trik UI-only. Website tidak dapat secara langsung mengubah hardware atau memaksa panel layar naik refresh rate — fitur "booster" di sini memaksimalkan prioritas rendering pada halaman dan mematikan animasi yang tidak perlu.</p>
      </aside>
    </div>

    <footer class="card">
      <div>Made with ♥ — HP Optimizer • Versi ringan (langsung di browser)</div>
    </footer>
  </div>

  <script>
    // ---------- Utilities ----------
    const el = id => document.getElementById(id);

    // ---------- Clean / Optimize ----------
    el('btn-clean').addEventListener('click', async ()=>{
      try{
        localStorage.clear();
        sessionStorage.clear();
        // try unregister service workers that belong to this origin
        if('serviceWorker' in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          await Promise.all(regs.map(r=>r.unregister()));
        }
        el('clean-result').textContent = 'Selesai: cache lokal & service worker (origin) dibersihkan.';
      }catch(e){
        el('clean-result').textContent = 'Gagal membersihkan: '+e.message;
      }
    });

    el('btn-suggestions').addEventListener('click', ()=>{
      alert('Tips singkat:\n1) Tutup aplikasi berat dan tab browser.\n2) Matikan sinkronisasi/backup saat main game.\n3) Gunakan mode hemat daya hanya jika tidak butuh FPS.\n4) Hapus file & foto yang tidak terpakai.');
    });

    // ---------- FPS Monitor & Booster ----------
    let lastTime = performance.now();
    let frameCount = 0;
    let fps = 0;
    let rafId = null;
    let animationsPaused = false;
    let boostMode = false;

    function measure(now){
      frameCount++;
      const delta = now - lastTime;
      if(delta >= 500){
        fps = Math.round((frameCount / delta) * 1000);
        el('fpsValue').textContent = fps + ' fps';
        const pct = Math.min(100, Math.round((fps/60)*100));
        el('fpsBar').style.width = pct + '%';
        frameCount = 0;
        lastTime = now;
      }
      rafId = requestAnimationFrame(measure);
    }
    rafId = requestAnimationFrame(measure);

    el('btn-stop-anim').addEventListener('click', ()=>{
      // Pause CSS animations and transitions by adding a style element
      if(!animationsPaused){
        window._savedAnimationStyle = document.createElement('style');
        window._savedAnimationStyle.id = 'pause-anim-style';
        window._savedAnimationStyle.textContent = '*{animation-play-state:paused !important; transition:none !important; caret-color:transparent !important}';
        document.head.appendChild(window._savedAnimationStyle);
        el('fps-note').textContent = 'Animasi halaman dijeda — beberapa elemen mungkin tampak "beku".';
        animationsPaused = true;
      }else{
        const s = document.getElementById('pause-anim-style'); if(s) s.remove();
        el('fps-note').textContent = 'Animasi kembali normal.';
        animationsPaused = false;
      }
    });

    el('btn-toggle-boost').addEventListener('click', ()=>{
      boostMode = !boostMode;
      if(boostMode){
        // try reduce repaint by hiding heavy elements (demo canvas aside)
        document.documentElement.style.willChange = 'transform, opacity';
        document.documentElement.style['-webkit-transform'] = 'translateZ(0)';
        el('fps-note').textContent = 'Mode Game aktif: memprioritaskan rendering halaman ini. (Tidak mengubah refresh rate hardware)';
        el('btn-toggle-boost').textContent = 'Matikan Mode Game';
      }else{
        document.documentElement.style.willChange = '';
        document.documentElement.style['-webkit-transform'] = '';
        el('fps-note').textContent = 'Mode Game dimatikan.';
        el('btn-toggle-boost').textContent = 'Aktifkan Mode Game';
      }
    });

    // Simple canvas demo to show rendering vs FPS
    let runningDemo = false;
    el('btn-run-demo').addEventListener('click', ()=>{
      const canvas = el('gameCanvas');
      if(!runningDemo){
        canvas.style.display = 'block';
        startDemo(canvas);
        el('btn-run-demo').textContent = 'Hentikan Demo';
        runningDemo = true;
      }else{
        stopDemo();
        canvas.style.display = 'none';
        el('btn-run-demo').textContent = 'Jalankan Demo (Canvas)';
        runningDemo = false;
      }
    });

    // Canvas demo implementation
    let demoRAF = null;
    let dots = [];
    function startDemo(canvas){
      const ctx = canvas.getContext('2d');
      dots = Array.from({length:40}, ()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,vx:(Math.random()-0.5)*1.8,vy:(Math.random()-0.5)*1.8,r:6+Math.random()*8}));
      function frame(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        for(const d of dots){
          d.x += d.vx; d.y += d.vy;
          if(d.x<0||d.x>canvas.width) d.vx *= -1;
          if(d.y<0||d.y>canvas.height) d.vy *= -1;
          ctx.beginPath(); ctx.arc(d.x,d.y,d.r,0,Math.PI*2); ctx.fillStyle='rgba(14,165,255,0.9)'; ctx.fill();
        }
        demoRAF = requestAnimationFrame(frame);
      }
      demoRAF = requestAnimationFrame(frame);
    }
    function stopDemo(){ if(demoRAF) cancelAnimationFrame(demoRAF); demoRAF = null; }

    // ---------- Network info & tests ----------
    const log = txt => el('speed-log').textContent = txt;

    function showConnectionInfo(){
      const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      if(conn){
        el('type').textContent = conn.effectiveType || conn.type || '-';
        if(conn.downlink) el('downlink').textContent = (Math.round(conn.downlink*10)/10) + ' Mbps';
        if(conn.rtt) el('rtt').textContent = (conn.rtt)+ ' ms';
        log('Sumber: Network Information API (estimasi).');
      }else{
        el('type').textContent = 'Tidak tersedia';
        log('Network Information API tidak tersedia di browser.');
      }
    }

    el('btn-conninfo').addEventListener('click', showConnectionInfo);

    // Ping test (approx) by fetching a small resource
    async function pingTest(){
      const url = 'https://upload.wikimedia.org/wikipedia/commons/3/3f/Fronalpstock_big.jpg';
      try{
        const t0 = performance.now();
        // HEAD request might be blocked; use GET but limit by aborting quickly
        const controller = new AbortController();
        const id = setTimeout(()=>controller.abort(), 5000);
        const resp = await fetch(url, {method:'GET',signal:controller.signal, cache:'no-store'});
        clearTimeout(id);
        const t1 = performance.now();
        const time = Math.round(t1-t0);
        el('ping').textContent = time + ' ms';
        log('Ping test selesai (fetch resource).');
      }catch(e){
        el('ping').textContent = 'Gagal';
        log('Ping gagal: '+e.message);
      }
    }
    el('btn-ping').addEventListener('click', pingTest);

    // Speed test by downloading a known image and measuring bytes/time
    async function speedTest(){
      const url = 'https://upload.wikimedia.org/wikipedia/commons/3/3f/Fronalpstock_big.jpg'; // ~4MB
      log('Mulai speed test — mengunduh file uji (may take a few seconds)...');
      try{
        const t0 = performance.now();
        const resp = await fetch(url, {cache:'no-store'});
        const reader = resp.body.getReader();
        let received = 0;
        const start = performance.now();
        while(true){
          const {done, value} = await reader.read();
          if(done) break;
          received += value.length;
          // update intermediate
          const now = performance.now();
          const secs = Math.max((now - start)/1000, 0.0001);
          const bps = (received*8)/secs; // bits per second
          const mbps = (bps/1024/1024).toFixed(2);
          el('downlink').textContent = mbps + ' Mbps';
        }
        const t1 = performance.now();
        const secs = (t1-t0)/1000;
        const bps = (received*8)/secs;
        const finalMbps = (bps/1024/1024).toFixed(2);
        el('downlink').textContent = finalMbps + ' Mbps';
        log('Speed test selesai — hasil bersifat indikatif.');
      }catch(e){
        log('Speed test gagal: '+e.message+' — fallback ke Network Information API (jika tersedia).');
        const conn = navigator.connection;
        if(conn && conn.downlink) el('downlink').textContent = (Math.round(conn.downlink*10)/10) + ' Mbps';
        else el('downlink').textContent = '-';
      }
    }
    el('btn-speed').addEventListener('click', speedTest);

    // On load: show basic info
    showConnectionInfo();

    // Accessibility: warn user about limitations
    console.info('HP Optimizer: tools are diagnostics and UI performance helpers. This page cannot change hardware refresh rate or close other apps on device.');
  </script>
</body>
</html>
